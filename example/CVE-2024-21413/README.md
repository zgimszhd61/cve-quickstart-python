# CVE-2024-21413 | Microsoft Outlook Remote Code Execution Vulnerability PoC

## 📜 Description

本脚本提供了CVE-2024-21413的概念验证（PoC），这是在Microsoft Outlook中发现的一个重大安全漏洞，CVSS评分为9.8。被称为#MonikerLink漏洞，这个漏洞的影响深远，包括可能泄露本地NTLM信息和远程代码执行的可能性。此外，它还揭示了一个可以绕过Office受保护视图的攻击途径，因此扩大了其对其他Office应用程序的威胁。

## 🚀 Usage

请负责任地使用这个工具，并确保你有目标系统所有者的授权。这个脚本需要SMTP认证来发送电子邮件，绕过SPF、DKIM和DMARC检查，这有助于更有效地模拟现实世界的攻击场景。

```bash
python CVE-2024-21413.py --server "<SMTP server>" --port <SMTP port> --username "<SMTP username>" --password "<SMTP password>" --sender "<sender email>" --recipient "<recipient email>" --url "<link URL>" --subject "<email subject>"
```

**Parameters:**

- `--server`: SMTP server hostname or IP.
- `--port`: SMTP server port.
- `--username`: SMTP server username for authentication.
- `--password`: SMTP server password for authentication.
- `--sender`: Sender email address.
- `--recipient`: Recipient email address.
- `--url`: Malicious path to include in the email.
- `--subject`: Email subject.

### Initial Sending 

<img width="730" alt="image" src="https://github.com/xaitax/CVE-2024-21413-Microsoft-Outlook-Remote-Code-Execution-Vulnerability/assets/5014849/5b68f853-e278-48cc-98fa-f560509d7d44">

### Display in Outlook (no warnings, no Protected view)

![image](https://github.com/xaitax/CVE-2024-21413-Microsoft-Outlook-Remote-Code-Execution-Vulnerability/assets/5014849/914110cb-ee5d-432a-bac5-c8243015658a)

### Wireshark capture including NTLM credentials (you can also run impacket, alternatively)

<img width="604" alt="image" src="https://github.com/xaitax/CVE-2024-21413-Microsoft-Outlook-Remote-Code-Execution-Vulnerability/assets/5014849/89edf325-9a16-4977-be3a-4e9064bb003f">

## 🧐 Why SMTP Authentication?

SMTP认证对于本演示至关重要，以确保发送的电子邮件绕过常见的电子邮件验证检查，如SPF（发件人策略框架）、DKIM（域密钥识别邮件）和DMARC（基于域的消息认证、报告和合规性）。这些安全措施旨在检测和防止电子邮件欺骗，其中攻击者从伪造的地址发送电子邮件。通过使用经过认证的SMTP，演示更贴近于一个复杂攻击者如何绕过这些保护的方式，使测试环境更加真实，并强调了全面的电子邮件安全实践的重要性。

## Demos

### 0-click NTLM Leak

![CVE-2024-21413-NTLM_Leak-0-click-Text](https://github.com/xaitax/CVE-2024-21413-Microsoft-Outlook-Remote-Code-Execution-Vulnerability/assets/5014849/8e23f3cd-1904-4d3e-b5d3-a0b58c0318b7)

### 1-click Remote Code Execution (RCE)

![CVE-2024-21413-RCE](https://github.com/xaitax/CVE-2024-21413-Microsoft-Outlook-Remote-Code-Execution-Vulnerability/assets/5014849/cd0dbae7-aaec-4532-9114-b58239fe5775)

## 📆 Changelog

### [19. February 2024] - Added 0-Click NTLM Leak

- Confirmed and managed 0-click NTLM Leak (thanks to [JT](https://x.com/johntroony)!)
- Not yet published

### [18. February 2024] - Added 1-click RCE

- Managed & confirmed Microsoft Outlook Remote Code Execution (RCE)
- Not yet published

### [16. February 2024] - Initial Release

- Initial release showcasing the exploit for CVE-2024-21413.

## Credits

- [Checkpoint](https://research.checkpoint.com/2024/the-risks-of-the-monikerlink-bug-in-microsoft-outlook-and-the-big-picture/) has done all the amazing research.
- [Microsoft Security Advisory](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2024-21413)

## 📌 Author

**Alexander Hagenah**
- [Website](https://primepage.de)
- [Twitter](https://twitter.com/xaitax)
- [LinkedIn](https://www.linkedin.com/in/alexhagenah/)

## ⚠️ Disclaimer

此工具仅用于教育和伦理测试目的。未经授权的扫描、测试或利用系统是非法和不道德的。确保你有明确的、授权的许可来进行任何针对目标系统的测试或利用活动。



